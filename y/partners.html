<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Our Partners - Nepal Local Connect</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', sans-serif;
  background: #f4f7f8;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 1000px;
  margin: 40px auto;
  padding: 0 20px;
}

h1 {
  text-align: center;
  margin-bottom: 30px;
  color: #222;
}

.business-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
  gap: 20px;
}

.business-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.1);
  overflow: hidden;
  transition: transform 0.2s;
}

.business-card:hover {
  transform: translateY(-5px);
}

.business-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}

.card-content {
  padding: 15px 20px;
}

.card-content h3 {
  margin: 0;
  font-size: 18px;
  color: #111;
}

.card-content p {
  margin: 5px 0;
  color: #555;
  font-size: 14px;
}

.rating {
  display: flex;
  align-items: center;
  margin-top: 10px;
}

.star {
  font-size: 20px;
  color: #ccc;
  cursor: pointer;
  margin-right: 5px;
}

.star.selected,
.star:hover,
.star:hover ~ .star {
  color: #facc15; /* yellow */
}

.message {
  text-align: center;
  color: green;
  margin-top: 10px;
  font-weight: 500;
}
</style>
</head>
<body>
<div class="container">
  <h1>Our Partners</h1>
  <div class="business-grid" id="business-grid">
    <!-- Business cards will be injected here -->
  </div>
  <p id="msg" class="message"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyC_dRLjrZnMVg9XJNXrIHwJQ054TaV6a1U",
  authDomain: "nepal-local-connect-16e2b.firebaseapp.com",
  projectId: "nepal-local-connect-16e2b",
  storageBucket: "nepal-local-connect-16e2b.appspot.com",
  messagingSenderId: "174039102881",
  appId: "1:174039102881:web:b483996d60febdf7c847e0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const businessGrid = document.getElementById('business-grid');
const msg = document.getElementById('msg');

// Fetch all businesses
async function loadBusinesses() {
  const querySnapshot = await getDocs(collection(db, "businesses"));
  businessGrid.innerHTML = "";
  querySnapshot.forEach(docSnap => {
    const data = docSnap.data();
    const card = document.createElement('div');
    card.className = "business-card";
    card.innerHTML = `
     <div class="card-content">
  <h3>${data.title}</h3>
  <img src="${data.imageUrl || 'default.png'}" class="card-img" />

  <p><strong>Description:</strong> ${data.description || "-"}</p>
  <p><strong>Type:</strong> ${data.type || "-"}</p>
  <p><strong>Contact:</strong> ${data.contact || "-"}</p>

  <div class="rating" data-id="${docSnap.id}">
    ${renderStars(data.ratingAverage || 0)}
  </div>
</div>

    `;
    businessGrid.appendChild(card);

    // Add click event for rating
    const stars = card.querySelectorAll('.star');
    stars.forEach((star, index) => {
      star.addEventListener('click', async () => {
        await updateDoc(doc(db, "businesses", docSnap.id), { Rating: index + 1 });
        msg.textContent = `You rated ${data.Name} ${index+1} star(s)!`;
        loadBusinesses(); // Refresh stars
      });
    });
  });
}

// Helper: render stars HTML
function renderStars(rating) {
  let html = '';
  for(let i=1; i<=5; i++){
    html += `<span class="star ${i <= rating ? 'selected' : ''}">&#9733;</span>`;
  }
  return html;
}

loadBusinesses();
</script>
</body>
</html>
